{"ast":null,"code":"import _defineProperty from \"/Users/datascience/belcorp/repo-pro-12/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"/Users/datascience/belcorp/repo-pro-12/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/datascience/belcorp/repo-pro-12/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/datascience/belcorp/repo-pro-12/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/datascience/belcorp/repo-pro-12/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/datascience/belcorp/repo-pro-12/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/datascience/belcorp/repo-pro-12/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/datascience/belcorp/repo-pro-12/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/datascience/belcorp/repo-pro-12/src/components/drawBox.js\";\nimport React, { Component } from 'react';\n\nfunction orderscore(descriptor) {\n  var sortable = [];\n\n  for (var _ in descriptor) {\n    sortable.push([_, Math.round(descriptor[_] * 100000) / 100000]);\n  }\n\n  sortable = sortable.sort(function (a, b) {\n    return b[1] - a[1];\n  });\n  return sortable;\n}\n\nvar DrawBox =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(DrawBox, _Component);\n\n  function DrawBox(_props) {\n    var _this;\n\n    _classCallCheck(this, DrawBox);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(DrawBox).call(this, _props));\n    _this.getDescription =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      var props,\n          fullDesc,\n          faceMatcher,\n          match,\n          express,\n          _args = arguments;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              props = _args.length > 0 && _args[0] !== undefined ? _args[0] : _this.props;\n              debugger;\n              fullDesc = props.fullDesc, faceMatcher = props.faceMatcher;\n\n              if (!fullDesc) {\n                _context.next = 15;\n                break;\n              }\n\n              _context.next = 6;\n              return _this.setState({\n                descriptors: fullDesc.map(function (fd) {\n                  return fd.descriptor;\n                }),\n                detections: fullDesc.map(function (fd) {\n                  return fd.detection;\n                }),\n                expressions: fullDesc.map(function (fd) {\n                  return fd.expressions;\n                }),\n                ages: fullDesc.map(function (fd) {\n                  return fd.age;\n                }),\n                gender: fullDesc.map(function (fd) {\n                  return fd.gender;\n                })\n              });\n\n            case 6:\n              if (!(!!_this.state.descriptors && !!faceMatcher)) {\n                _context.next = 15;\n                break;\n              }\n\n              _context.next = 9;\n              return _this.state.descriptors.map(function (descriptor) {\n                return faceMatcher.findBestMatch(descriptor);\n              });\n\n            case 9:\n              match = _context.sent;\n\n              _this.setState({\n                match: match\n              });\n\n              _context.next = 13;\n              return _this.state.expressions.map(function (descriptor) {\n                return orderscore(descriptor);\n              });\n\n            case 13:\n              express = _context.sent;\n\n              _this.setState({\n                express: express\n              });\n\n            case 15:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n    _this.state = {\n      descriptors: null,\n      detections: null,\n      match: null,\n      express: null\n    };\n    return _this;\n  }\n\n  _createClass(DrawBox, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.getDescription();\n    }\n  }, {\n    key: \"componentWillReceiveProps\",\n    value: function componentWillReceiveProps(newProps) {\n      console.log(\"newProps: \", newProps);\n      this.getDescription(newProps);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props = this.props,\n          imageWidth = _this$props.imageWidth,\n          boxColor = _this$props.boxColor;\n      var _this$state = this.state,\n          detections = _this$state.detections,\n          match = _this$state.match,\n          express = _this$state.express,\n          ages = _this$state.ages,\n          gender = _this$state.gender;\n      console.log(\"EDADDDDD: \", ages, \" gender: \", gender);\n      var box = null;\n\n      if (!!detections) {\n        box = detections.map(function (detection, i) {\n          var _ref2, _ref3;\n\n          var relativeBox = detection.relativeBox;\n          var dimension = detection._imageDims;\n\n          var _X = imageWidth * relativeBox._x;\n\n          var _Y = relativeBox._y * imageWidth * dimension._height / dimension._width;\n\n          var _W = imageWidth * relativeBox.width;\n\n          var _H = relativeBox.height * imageWidth * dimension._height / dimension._width;\n\n          return React.createElement(\"div\", {\n            key: i,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 88\n            },\n            __self: this\n          }, React.createElement(\"div\", {\n            style: {\n              position: 'absolute',\n              border: 'solid',\n              borderColor: boxColor,\n              height: _H,\n              width: _W,\n              transform: \"translate(\".concat(_X, \"px,\").concat(_Y, \"px)\")\n            },\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 89\n            },\n            __self: this\n          }, !!express && express[i] ? React.createElement(\"p\", {\n            style: (_ref2 = {\n              backgroundColor: 'black',\n              border: 'solid',\n              borderColor: boxColor,\n              width: _W,\n              marginTop: -1,\n              color: 'white'\n            }, _defineProperty(_ref2, \"border\", 0), _defineProperty(_ref2, \"margin\", 0), _defineProperty(_ref2, \"transform\", \"translate(-3px,\".concat(_H, \"px)\")), _ref2),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 100\n            },\n            __self: this\n          }, \"(\", Math.ceil(ages[i]), \") \", gender[i], \"/ \", express[i][0][0]) : null, !!match && match[i] && match[i]._label !== 'unknown' ? React.createElement(\"p\", {\n            style: (_ref3 = {\n              backgroundColor: boxColor,\n              border: 'solid',\n              borderColor: boxColor,\n              width: _W,\n              marginTop: -1,\n              color: '#fff'\n            }, _defineProperty(_ref3, \"border\", 0), _defineProperty(_ref3, \"margin\", 0), _defineProperty(_ref3, \"transform\", \"translate(-3px,\".concat(_H, \"px)\")), _ref3),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 118\n            },\n            __self: this\n          }, match[i]._label) : null));\n        });\n      }\n\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 141\n        },\n        __self: this\n      }, box);\n    }\n  }]);\n\n  return DrawBox;\n}(Component);\n\nexport default DrawBox;","map":{"version":3,"sources":["/Users/datascience/belcorp/repo-pro-12/src/components/drawBox.js"],"names":["React","Component","orderscore","descriptor","sortable","_","push","Math","round","sort","a","b","DrawBox","props","getDescription","fullDesc","faceMatcher","setState","descriptors","map","fd","detections","detection","expressions","ages","age","gender","state","findBestMatch","match","express","newProps","console","log","imageWidth","boxColor","box","i","relativeBox","dimension","_imageDims","_X","_x","_Y","_y","_height","_width","_W","width","_H","height","position","border","borderColor","transform","backgroundColor","marginTop","color","ceil","_label"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\n\n\nfunction orderscore(descriptor) {\n    var sortable = [];\n    for (var _ in descriptor) {\n        sortable.push(\n          [_, Math.round(descriptor[_]*100000)/100000]    \n        );\n    }\n    \n    sortable = sortable.sort(function(a, b) {\n        return b[1] - a[1];\n    });\n\n    return sortable\n}\n\nclass DrawBox extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      descriptors: null,\n      detections: null,\n      match: null,\n      express: null\n    };\n  }\n  \n  componentDidMount() {\n    this.getDescription();\n  }\n\n  componentWillReceiveProps(newProps) {\n    console.log(\"newProps: \", newProps)\n    this.getDescription(newProps);\n  }\n\n  getDescription = async (props = this.props) => {\n    debugger;\n    const { fullDesc, faceMatcher } = props;\n\n    if (!!fullDesc) {\n\n      await this.setState({\n        descriptors: fullDesc.map(fd => fd.descriptor),\n        detections: fullDesc.map(fd => fd.detection),\n        expressions: fullDesc.map(fd => fd.expressions),\n        ages: fullDesc.map(fd => fd.age),\n        gender: fullDesc.map(fd => fd.gender),\n      });\n\n      if (!!this.state.descriptors && !!faceMatcher) {\n        let match = await this.state.descriptors.map(descriptor =>\n          faceMatcher.findBestMatch(descriptor)\n        );\n        this.setState({ match });\n\n\n        let express = await this.state.expressions.map(descriptor => orderscore(descriptor));\n        this.setState({ express });\n      }\n\n    }\n  };\n  \n  render() {\n    const { imageWidth, boxColor } = this.props;\n    const { detections, match, express, ages, gender} = this.state;\n    \n    console.log(\"EDADDDDD: \", ages, \" gender: \", gender)\n\n    let box = null;\n\n    if (!!detections) {\n      box = detections.map((detection, i) => {\n        const relativeBox = detection.relativeBox;\n        const dimension = detection._imageDims;\n        let _X = imageWidth * relativeBox._x;\n        let _Y =\n          (relativeBox._y * imageWidth * dimension._height) / dimension._width;\n        let _W = imageWidth * relativeBox.width;\n        let _H =\n          (relativeBox.height * imageWidth * dimension._height) /\n          dimension._width;\n\n        return (\n          <div key={i}>\n            <div\n              style={{\n                position: 'absolute',\n                border: 'solid',\n                borderColor: boxColor,\n                height: _H,\n                width: _W,\n                transform: `translate(${_X}px,${_Y}px)`\n              }}\n            >\n              {!!express && express[i] ? (\n                <p\n                  style={{\n                    backgroundColor: 'black',\n                    border: 'solid',\n                    borderColor: boxColor,\n                    width: _W,\n                    marginTop: -1,\n                    color: 'white',\n                    border:0,\n                    margin:0,\n                    transform: `translate(-3px,${_H}px)`\n                  }}\n                >\n                ({Math.ceil(ages[i])}) {gender[i]}/ {express[i][0][0]}\n                </p>\n\n              ) : null}            \n              {!!match && match[i] && match[i]._label !== 'unknown' ? (\n                <p\n                  style={{\n                    backgroundColor: boxColor,\n                    border: 'solid',\n                    borderColor: boxColor,\n                    width: _W,\n                    marginTop: -1,\n                    color: '#fff',\n                    border:0,\n                    margin:0,\n                    transform: `translate(-3px,${_H}px)`\n                  }}\n                >\n                  {match[i]._label}\n                </p>\n\n              ) : null}\n            </div>\n          </div>\n        );\n      });\n    }\n\n    return <div>{box}</div>;\n  }\n}\n\nexport default DrawBox;\n"]},"metadata":{},"sourceType":"module"}