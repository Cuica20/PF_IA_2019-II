{"ast":null,"code":"import _objectSpread from \"/Users/datascience/belcorp/repo-pro-12/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _regeneratorRuntime from \"/Users/datascience/belcorp/repo-pro-12/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/datascience/belcorp/repo-pro-12/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/datascience/belcorp/repo-pro-12/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/datascience/belcorp/repo-pro-12/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/datascience/belcorp/repo-pro-12/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/datascience/belcorp/repo-pro-12/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/datascience/belcorp/repo-pro-12/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/datascience/belcorp/repo-pro-12/src/views/caracteristicasFoto.js\";\nimport React, { Component } from 'react';\nimport { withRouter } from 'react-router-dom';\nimport { loadModels, getFullFaceDescription, createMatcher, isFaceDetectionModelLoaded } from '../api/face';\nimport DrawBox from '../components/drawBox';\nimport ShowDescriptors from '../components/showDescriptors';\nimport { JSON_PROFILE } from '../common/profile';\nvar MaxWidth = 600;\nvar boxColor = '#4da1b8';\n\nvar testImg = require('../img/test.jpg');\n\nimport myData from '../json/caracteristicasFoto.json';\nvar INIT_STATE = {\n  url: null,\n  imageURL: null,\n  fullDesc: null,\n  imageDimension: null,\n  error: null,\n  loading: false\n};\n\nvar CaracteristicasFoto =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(CaracteristicasFoto, _Component);\n\n  function CaracteristicasFoto(props) {\n    var _this;\n\n    _classCallCheck(this, CaracteristicasFoto);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(CaracteristicasFoto).call(this, props));\n    _this.mounting =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return loadModels();\n\n            case 2:\n              _context.next = 4;\n              return _this.matcher();\n\n            case 4:\n              _context.next = 6;\n              return _this.getImageDimension(testImg);\n\n            case 6:\n              _context.next = 8;\n              return _this.setState({\n                imageURL: testImg,\n                loading: true\n              });\n\n            case 8:\n              _context.next = 10;\n              return _this.handleImageChange(testImg);\n\n            case 10:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n    _this.matcher =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee2() {\n      var faceMatcher;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.t0 = createMatcher;\n              _context2.next = 3;\n              return JSON_PROFILE();\n\n            case 3:\n              _context2.t1 = _context2.sent;\n              _context2.next = 6;\n              return (0, _context2.t0)(_context2.t1);\n\n            case 6:\n              faceMatcher = _context2.sent;\n\n              _this.setState({\n                faceMatcher: faceMatcher\n              });\n\n            case 8:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    _this.handleFileChange =\n    /*#__PURE__*/\n    function () {\n      var _ref3 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee3(event) {\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _this.resetState();\n\n                if (!(event.target.files.length > 0)) {\n                  _context3.next = 5;\n                  break;\n                }\n\n                _context3.next = 4;\n                return _this.setState({\n                  imageURL: URL.createObjectURL(event.target.files[0]),\n                  loading: true\n                });\n\n              case 4:\n                _this.handleImageChange();\n\n              case 5:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }));\n\n      return function (_x) {\n        return _ref3.apply(this, arguments);\n      };\n    }();\n\n    _this.handleURLChange = function (event) {\n      _this.setState({\n        url: event.target.value\n      });\n    };\n\n    _this.handleButtonClick =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee4() {\n      var blob;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _this.resetState();\n\n              _context4.next = 3;\n              return fetch(_this.state.url).then(function (r) {\n                return r.blob();\n              }).catch(function (error) {\n                return _this.setState({\n                  error: error\n                });\n              });\n\n            case 3:\n              blob = _context4.sent;\n\n              if (!!blob && blob.type.includes('image')) {\n                _this.setState({\n                  imageURL: URL.createObjectURL(blob),\n                  loading: true\n                });\n\n                _this.handleImageChange();\n              }\n\n            case 5:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n    _this.handleImageChange =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee5() {\n      var image,\n          _args5 = arguments;\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              image = _args5.length > 0 && _args5[0] !== undefined ? _args5[0] : _this.state.imageURL;\n              _context5.next = 3;\n              return _this.getImageDimension(image);\n\n            case 3:\n              console.log(\"@@@@@ this.state: \", _this.state);\n              _context5.next = 6;\n              return getFullFaceDescription(image, _this.state.WIDTH, _this.state.HEIGHT).then(function (fullDesc) {\n                _this.setState({\n                  fullDesc: fullDesc,\n                  loading: false\n                });\n              });\n\n            case 6:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5);\n    }));\n\n    _this.getImageDimension = function (imageURL) {\n      var img = new Image();\n\n      img.onload = function () {\n        var HEIGHT = _this.state.WIDTH * img.height / img.width;\n\n        _this.setState({\n          HEIGHT: HEIGHT,\n          imageDimension: {\n            width: img.width,\n            height: img.height\n          }\n        });\n      };\n\n      img.src = imageURL;\n    };\n\n    _this.handleDescriptorsCheck = function (event) {\n      _this.setState({\n        showDescriptors: event.target.checked\n      });\n    };\n\n    _this.resetState = function () {\n      _this.setState(_objectSpread({}, INIT_STATE));\n    };\n\n    _this.state = _objectSpread({}, INIT_STATE, {\n      faceMatcher: null,\n      showDescriptors: false,\n      WIDTH: null,\n      HEIGHT: 0,\n      isModelLoaded: !!isFaceDetectionModelLoaded(),\n      caracteristicasFoto: []\n    });\n    return _this;\n  }\n\n  _createClass(CaracteristicasFoto, [{\n    key: \"componentWillMount\",\n    value: function componentWillMount() {\n      var _this2 = this;\n\n      this.resetState();\n      var _W = document.documentElement.clientWidth;\n      if (_W > MaxWidth) _W = MaxWidth;\n      this.setState({\n        WIDTH: _W\n      });\n      this.mounting();\n      axios.get('../json/caracteristicasFoto.json') // JSON File Path\n      .then(function (response) {\n        _this2.setState({\n          caracteristicasFoto: response.data\n        });\n      }).catch(function (error) {\n        console.log(error);\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$state = this.state,\n          WIDTH = _this$state.WIDTH,\n          HEIGHT = _this$state.HEIGHT,\n          imageURL = _this$state.imageURL,\n          fullDesc = _this$state.fullDesc,\n          faceMatcher = _this$state.faceMatcher,\n          showDescriptors = _this$state.showDescriptors,\n          isModelLoaded = _this$state.isModelLoaded,\n          error = _this$state.error,\n          loading = _this$state.loading; // Display working status\n\n      var status = React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 148\n        },\n        __self: this\n      }, \"Status: Model Loaded = \", isModelLoaded.toString());\n\n      if (!!error && error.toString() === 'TypeError: Failed to fetch') {\n        status = React.createElement(\"p\", {\n          style: {\n            color: 'red'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 151\n          },\n          __self: this\n        }, \"Status: Error Failed to fetch Image URL\");\n      } else if (loading) {\n        status = React.createElement(\"p\", {\n          style: {\n            color: 'blue'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 154\n          },\n          __self: this\n        }, \"Status: LOADING...\");\n      } else if (!!fullDesc && !!imageURL && !loading) {\n        if (fullDesc.length < 2) status = React.createElement(\"p\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 157\n          },\n          __self: this\n        }, \" \", fullDesc.length, \" rostro detectado\");\n        if (fullDesc.length > 1) status = React.createElement(\"p\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 159\n          },\n          __self: this\n        }, fullDesc.length, \" Rostros detectados\");\n      }\n\n      var caracteristicasFoto = this.state.caracteristicasFoto;\n      var usersListBlock = '';\n\n      if (caracteristicasFoto.length > 0) {\n        usersListBlock = caracteristicasFoto.map(function (obj) {\n          return React.createElement(Usercard, {\n            key: obj.id,\n            id: obj.id,\n            imgPath: obj.avatar_url,\n            name: obj.name,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 168\n            },\n            __self: this\n          });\n        });\n      }\n\n      return React.createElement(\"div\", {\n        className: \"row container\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 174\n        },\n        __self: this\n      }, usersListBlock); // Loading Spinner\n\n      var spinner = React.createElement(\"div\", {\n        style: {\n          margin: 0,\n          color: '#4da1b8',\n          position: 'absolute',\n          top: '50%',\n          left: '50%',\n          transform: 'translate(-50%,-50%)',\n          textShadow: '2px 2px 3px #fff'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 181\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"loading\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 192\n        },\n        __self: this\n      }), React.createElement(\"h3\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 193\n        },\n        __self: this\n      }, \"Processing...\"));\n      return React.createElement(\"div\", {\n        style: {\n          display: 'flex',\n          flexDirection: 'column',\n          alignItems: 'center'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 198\n        },\n        __self: this\n      }, status, React.createElement(\"div\", {\n        style: {\n          position: 'relative',\n          width: WIDTH,\n          height: HEIGHT\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 205\n        },\n        __self: this\n      }, !!imageURL ? React.createElement(\"div\", {\n        style: {\n          position: 'relative'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 213\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        style: {\n          position: 'absolute'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 218\n        },\n        __self: this\n      }, React.createElement(\"img\", {\n        style: {\n          width: WIDTH\n        },\n        src: imageURL,\n        alt: \"imageURL\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 219\n        },\n        __self: this\n      })), !!fullDesc ? React.createElement(DrawBox, {\n        fullDesc: fullDesc,\n        faceMatcher: faceMatcher,\n        imageWidth: WIDTH,\n        boxColor: boxColor,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 222\n        },\n        __self: this\n      }) : null) : null, loading ? spinner : null), React.createElement(\"div\", {\n        style: {\n          width: WIDTH,\n          padding: 10,\n          marginTop: 10\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 233\n        },\n        __self: this\n      }, React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 240\n        },\n        __self: this\n      }, \"Cargue una imagen desde su dispositivo o indique una URL v\\xE1lida\"), React.createElement(\"input\", {\n        id: \"myFileUpload\",\n        type: \"file\",\n        onChange: this.handleFileChange,\n        accept: \".jpg, .jpeg, .png\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 241\n        },\n        __self: this\n      }), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 247\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"URLInput\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 248\n        },\n        __self: this\n      }, React.createElement(\"input\", {\n        type: \"url\",\n        name: \"url\",\n        id: \"url\",\n        placeholder: \"Place your photo URL here (only .jpg, .jpeg, .png)\",\n        pattern: \"https://.*\",\n        size: \"30\",\n        onChange: this.handleURLChange,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 249\n        },\n        __self: this\n      }), React.createElement(\"button\", {\n        onClick: this.handleButtonClick,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 258\n        },\n        __self: this\n      }, \"Subir\")), React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 260\n        },\n        __self: this\n      }, React.createElement(\"input\", {\n        name: \"descriptors\",\n        type: \"checkbox\",\n        checked: this.state.showDescriptors,\n        onChange: this.handleDescriptorsCheck,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 261\n        },\n        __self: this\n      }), React.createElement(\"label\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 267\n        },\n        __self: this\n      }, \"Mostrar Descripciones\")), !!showDescriptors ? React.createElement(ShowDescriptors, {\n        fullDesc: fullDesc,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 269\n        },\n        __self: this\n      }) : null));\n    }\n  }]);\n\n  return CaracteristicasFoto;\n}(Component);\n\nexport default withRouter(CaracteristicasFoto);","map":{"version":3,"sources":["/Users/datascience/belcorp/repo-pro-12/src/views/caracteristicasFoto.js"],"names":["React","Component","withRouter","loadModels","getFullFaceDescription","createMatcher","isFaceDetectionModelLoaded","DrawBox","ShowDescriptors","JSON_PROFILE","MaxWidth","boxColor","testImg","require","myData","INIT_STATE","url","imageURL","fullDesc","imageDimension","error","loading","CaracteristicasFoto","props","mounting","matcher","getImageDimension","setState","handleImageChange","faceMatcher","handleFileChange","event","resetState","target","files","length","URL","createObjectURL","handleURLChange","value","handleButtonClick","fetch","state","then","r","blob","catch","type","includes","image","console","log","WIDTH","HEIGHT","img","Image","onload","height","width","src","handleDescriptorsCheck","showDescriptors","checked","isModelLoaded","caracteristicasFoto","_W","document","documentElement","clientWidth","axios","get","response","data","status","toString","color","usersListBlock","map","obj","id","avatar_url","name","spinner","margin","position","top","left","transform","textShadow","display","flexDirection","alignItems","padding","marginTop"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { withRouter } from 'react-router-dom';\nimport {\n  loadModels,\n  getFullFaceDescription,\n  createMatcher,\n  isFaceDetectionModelLoaded\n} from '../api/face';\nimport DrawBox from '../components/drawBox';\nimport ShowDescriptors from '../components/showDescriptors';\nimport { JSON_PROFILE } from '../common/profile';\n\nconst MaxWidth = 600;\nconst boxColor = '#4da1b8';\nconst testImg = require('../img/test.jpg');\n\nimport myData from '../json/caracteristicasFoto.json';\n\nconst INIT_STATE = {\n  url: null,\n  imageURL: null,\n  fullDesc: null,\n  imageDimension: null,\n  error: null,\n  loading: false\n};\n\nclass CaracteristicasFoto extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      ...INIT_STATE,\n      faceMatcher: null,\n      showDescriptors: false,\n      WIDTH: null,\n      HEIGHT: 0,\n      isModelLoaded: !!isFaceDetectionModelLoaded(),\n      caracteristicasFoto: []\n    };\n  }\n\n  componentWillMount() {\n    this.resetState();\n    let _W = document.documentElement.clientWidth;\n    if (_W > MaxWidth) _W = MaxWidth;\n    this.setState({ WIDTH: _W });\n    this.mounting();\n\n    axios.get('../json/caracteristicasFoto.json') // JSON File Path\n        .then( response => {\n          this.setState({\n            caracteristicasFoto: response.data\n          });\n        })\n        .catch(function (error) {\n          console.log(error);\n        });\n  }\n\n  mounting = async () => {\n    await loadModels();\n    await this.matcher();\n    await this.getImageDimension(testImg);\n    await this.setState({ imageURL: testImg, loading: true });\n    await this.handleImageChange(testImg);\n  };\n\n  matcher = async () => {\n    const faceMatcher = await createMatcher(await JSON_PROFILE());\n    this.setState({ faceMatcher });\n  };\n\n  handleFileChange = async event => {\n    this.resetState();\n    if(event.target.files.length > 0){\n      await this.setState({\n        imageURL: URL.createObjectURL(event.target.files[0]),\n        loading: true\n      });\n      this.handleImageChange();\n    }\n  };\n\n  handleURLChange = event => {\n    this.setState({ url: event.target.value });\n  };\n\n  handleButtonClick = async () => {\n    this.resetState();\n    let blob = await fetch(this.state.url)\n      .then(r => r.blob())\n      .catch(error => this.setState({ error }));\n\n    if (!!blob && blob.type.includes('image')) {\n      this.setState({\n        imageURL: URL.createObjectURL(blob),\n        loading: true\n      });\n      this.handleImageChange();\n    }\n  };\n\n  handleImageChange = async (image = this.state.imageURL) => {\n    await this.getImageDimension(image);\n    console.log(\"@@@@@ this.state: \", this.state)\n\n    await getFullFaceDescription(image, this.state.WIDTH, this.state.HEIGHT).then(fullDesc => {\n      this.setState({ fullDesc, loading: false });\n    });\n  };\n\n  getImageDimension = imageURL => {\n    let img = new Image();\n    img.onload = () => {\n      let HEIGHT = (this.state.WIDTH * img.height) / img.width;\n      this.setState({\n        HEIGHT,\n        imageDimension: {\n          width: img.width,\n          height: img.height\n        }\n      });\n    };\n    img.src = imageURL;\n  };\n\n  handleDescriptorsCheck = event => {\n    this.setState({ showDescriptors: event.target.checked });\n  };\n\n  resetState = () => {\n    this.setState({ ...INIT_STATE });\n  };\n  render() {\n    const {\n      WIDTH,\n      HEIGHT,\n      imageURL,\n      fullDesc,\n      faceMatcher,\n      showDescriptors,\n      isModelLoaded,\n      error,\n      loading\n    } = this.state;\n\n    // Display working status\n    let status = <p>Status: Model Loaded = {isModelLoaded.toString()}</p>;\n    if (!!error && error.toString() === 'TypeError: Failed to fetch') {\n      status = (\n        <p style={{ color: 'red' }}>Status: Error Failed to fetch Image URL</p>\n      );\n    } else if (loading) {\n      status = <p style={{ color: 'blue' }}>Status: LOADING...</p>;\n    } else if (!!fullDesc && !!imageURL && !loading) {\n      if (fullDesc.length < 2)\n        status = <p> {fullDesc.length} rostro detectado</p>;\n      if (fullDesc.length > 1)\n        status = <p>{fullDesc.length} Rostros detectados</p>;\n    }\n\n    const caracteristicasFoto = this.state.caracteristicasFoto;\n    let usersListBlock = '';\n\n    if(caracteristicasFoto.length > 0) {\n      usersListBlock = caracteristicasFoto.map( obj => {\n        return (\n            <Usercard key={obj.id} id={obj.id} imgPath={obj.avatar_url} name={obj.name} />\n        )\n      })\n    }\n\n    return(\n        <div className=\"row container\">\n          {usersListBlock}\n        </div>\n    )\n\n    // Loading Spinner\n    let spinner = (\n      <div\n        style={{\n          margin: 0,\n          color: '#4da1b8',\n          position: 'absolute',\n          top: '50%',\n          left: '50%',\n          transform: 'translate(-50%,-50%)',\n          textShadow: '2px 2px 3px #fff'\n        }}\n      >\n        <div className=\"loading\" />\n        <h3>Processing...</h3>\n      </div>\n    );\n\n    return (\n      <div style={{\n          display: 'flex',\n          flexDirection: 'column',\n          alignItems: 'center'\n        }}\n      >\n        {status}\n        <div\n          style={{\n            position: 'relative',\n            width: WIDTH,\n            height: HEIGHT\n          }}\n        >\n          {!!imageURL ? (\n            <div\n              style={{\n                position: 'relative'\n              }}\n            >\n              <div style={{ position: 'absolute' }}>\n                <img style={{ width: WIDTH }} src={imageURL} alt=\"imageURL\" />\n              </div>\n              {!!fullDesc ? (\n                <DrawBox\n                  fullDesc={fullDesc}\n                  faceMatcher={faceMatcher}\n                  imageWidth={WIDTH}\n                  boxColor={boxColor}\n                />\n              ) : null}\n            </div>\n          ) : null}\n          {loading ? spinner : null}\n        </div>\n        <div\n          style={{\n            width: WIDTH,\n            padding: 10,\n            marginTop: 10\n          }}\n        >\n          <p>Cargue una imagen desde su dispositivo o indique una URL v√°lida</p>\n          <input\n            id=\"myFileUpload\"\n            type=\"file\"\n            onChange={this.handleFileChange}\n            accept=\".jpg, .jpeg, .png\"\n          />\n          <br />\n          <div className=\"URLInput\">\n            <input\n              type=\"url\"\n              name=\"url\"\n              id=\"url\"\n              placeholder=\"Place your photo URL here (only .jpg, .jpeg, .png)\"\n              pattern=\"https://.*\"\n              size=\"30\"\n              onChange={this.handleURLChange}\n            />\n            <button onClick={this.handleButtonClick}>Subir</button>\n          </div>\n          <div>\n            <input\n              name=\"descriptors\"\n              type=\"checkbox\"\n              checked={this.state.showDescriptors}\n              onChange={this.handleDescriptorsCheck}\n            />\n            <label>Mostrar Descripciones</label>\n          </div>\n          {!!showDescriptors ? <ShowDescriptors fullDesc={fullDesc} /> : null}\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default withRouter(CaracteristicasFoto);\n"]},"metadata":{},"sourceType":"module"}